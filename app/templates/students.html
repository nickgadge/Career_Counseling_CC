{% extends "base.html" %}
{% block content %}

<div class="container py-5" id="studentFormWrapper">
  <form method="post" action="{{ url_for('students.students_submit') }}" id="wizardForm">

    <!-- Student Info Card -->
    <div class="glass-card mb-5">
      <div class="card-header bg-gradient text-white rounded-top px-4 py-3">
        <h5 class="mb-0">Basic Student Info</h5>
      </div>
      <div class="card-body p-4">
        <div class="row g-4">
          <div class="col-md-4">
            <label class="form-label">Full Name</label>
            <input type="text" class="form-control modern-input" name="name" required placeholder="Enter your name">
          </div>
          <div class="col-md-4">
            <label class="form-label">Phone</label>
            <input type="tel" class="form-control modern-input" name="phone" required placeholder="Enter your phone">
          </div>
          <div class="col-md-4">
            <label class="form-label">Address</label>
            <input type="text" class="form-control modern-input" name="address" required placeholder="Enter your address">
          </div>
        </div>
      </div>
    </div>

    <!-- Step Indicators & Progress -->
    <div class="step-indicators text-center mb-4">
      <span class="step-dot active"></span>
      <span class="step-dot"></span>
      <span class="step-dot"></span>
      <span class="step-dot"></span>
      <span class="step-dot"></span>
    </div>
    <div class="mb-4">
      <div class="d-flex justify-content-between small mb-1">
        <span>Progress:</span>
        <span id="progressText" class="fw-bold text-primary">0%</span>
      </div>
      <div class="progress">
        <div class="progress-bar progress-bar-striped progress-bar-animated bg-success" id="progressBar" style="width: 0%"></div>
      </div>
      <div id="liveHint" class="text-muted text-end small mt-1"></div>
    </div>

    <!-- Question Steps -->
    <div id="stepsContainer">
      {% for q in questions %}
      <div class="glass-card mb-4 step" data-step="{{ loop.index0 }}" data-category="{{ q.category }}">
        <div class="card-body p-4">

          <!-- Question Header -->
          <div class="d-flex align-items-start justify-content-between mb-3">
            <div>
              <span class="badge bg-primary rounded-pill me-2">Q{{ q.id }}</span>
              <span class="fw-semibold">{{ q.mr }}</span><br>
              <small class="text-muted fst-italic">{{ q.en }}</small>
            </div>
            <span class="category-pill">{{ q.category|capitalize }}</span>
          </div>

          <!-- Question Options -->
          {% if q.type == 'likert' %}
          <div class="row row-cols-1 row-cols-md-5 g-3 mt-2">
            {% for opt in q.options %}
            <div class="col">
              <label class="option-box">
                <input type="radio" class="d-none" name="q{{ q.id }}" value="{{ opt.value }}" required>
                <div class="option-content">{{ opt.label }}</div>
              </label>
            </div>
            {% endfor %}
          </div>

          {% elif q.type == 'emoji' %}
          <div class="d-flex flex-wrap gap-4 fs-2 mt-3">
            {% for opt in q.options %}
            <label class="emoji-option">
              <input type="radio" hidden name="q{{ q.id }}" value="{{ opt.value }}" required>
              <span class="emoji">{{ opt.label }}</span>
            </label>
            {% endfor %}
          </div>

          {% elif q.type == 'slider' %}
          <div class="slider-wrapper mt-4">
            <input type="range" class="form-range custom-slider" name="q{{ q.id }}" min="{{ q.slider_min }}"
                   max="{{ q.slider_max }}" value="5" oninput="this.nextElementSibling.value=this.value" required>
            <output class="slider-value">5</output>
            <small class="text-muted">({{ q.slider_min }} - {{ q.slider_max }})</small>
          </div>

          {% elif q.type == 'multi' %}
          <div class="row row-cols-1 row-cols-md-2 g-3 mt-2">
            {% for opt in q.multi_options %}
            <div class="col">
              <label class="option-box">
                <input type="checkbox" class="d-none" name="q{{ q.id }}[]" value="1">
                <div class="option-content">{{ opt }}</div>
              </label>
            </div>
            {% endfor %}
          </div>
          <small class="text-muted">Select all that apply.</small>

          {% elif q.type == 'image' %}
          <div class="d-flex flex-wrap gap-3 mt-3">
            {% for opt in q.image_options %}
            <label class="image-option">
              <input type="radio" hidden name="q{{ q.id }}" value="{{ opt.value }}" required>
              <div class="img-card">
                <img src="{{ opt.img }}" alt="{{ opt.alt }}" onerror="this.src='https://via.placeholder.com/96?text=Image'">
              </div>
              <div class="small mt-2">{{ opt.alt }}</div>
            </label>
            {% endfor %}
          </div>
          {% endif %}
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- Navigation Buttons -->
    <div class="d-flex justify-content-between mt-5">
      <button type="button" class="btn btn-lg btn-outline-secondary px-4" id="prevBtn">â¬… Previous</button>
      <div>
        <button type="button" class="btn btn-lg btn-primary px-4" id="nextBtn">Next âž¡</button>
        <button type="submit" class="btn btn-lg btn-success px-4 d-none" id="submitBtn">ðŸŽ¯ Submit</button>
      </div>
    </div>

  </form>
</div>

<script src="{{ url_for('static', filename='js/students.js') }}"></script>

<!-- Custom Styling -->
<style>
  /* Hero Title Gradient */
  .text-gradient {
    background: linear-gradient(90deg, #007bff, #00c9a7, #6f42c1);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: gradientMove 4s infinite alternate;
  }
  @keyframes gradientMove {
    0% { filter: hue-rotate(0deg); }
    100% { filter: hue-rotate(45deg); }
  }

  /* Glass card effect */
  .glass-card {
    background: rgba(255,255,255,0.9);
    backdrop-filter: blur(6px);
    border-radius: 12px;
    box-shadow: 0px 4px 14px rgba(0,0,0,0.08);
  }
  .bg-gradient {
    background: linear-gradient(45deg, #007bff, #20c997);
  }

  /* Inputs */
  .modern-input {
    border-radius: 8px;
    border: 2px solid #e4e4e4;
    padding: 10px;
    transition: all 0.3s ease;
  }
  .modern-input:focus {
    border-color: #007bff;
    box-shadow: 0 0 8px rgba(0,123,255,0.2);
  }

  /* Options */
  .option-box {
    cursor: pointer;
  }
  .option-content {
    padding: 12px;
    border: 2px solid #ddd;
    border-radius: 10px;
    text-align: center;
    transition: all 0.3s;
  }
  .option-box:hover .option-content {
    border-color: #007bff;
    background: #f8fbff;
  }
  .option-box input:checked + .option-content {
    background: #007bff;
    color: white;
    border-color: #007bff;
    font-weight: bold;
    box-shadow: 0 0 8px rgba(0,123,255,0.3);
  }

  /* Emoji options */
  .emoji-option {
    cursor: pointer;
    transition: transform 0.2s;
  }
  .emoji-option:hover { transform: scale(1.1); }
  .emoji-option input:checked + .emoji {
    background: #007bff; color: white; padding: 8px 12px; border-radius: 10px;
  }

  /* Image options */
  .img-card {
    border: 2px solid #ddd;
    border-radius: 10px;
    overflow: hidden;
    transition: all 0.3s;
  }
  .img-card img { width: 96px; height: 96px; object-fit: cover; }
  .image-option input:checked + .img-card { border-color: #007bff; box-shadow: 0 0 8px rgba(0,123,255,0.3); }

  /* Step Dots */
  .step-indicators { display: flex; justify-content: center; gap: 8px; }
  .step-dot {
    width: 12px; height: 12px;
    border-radius: 50%;
    background: #ddd;
    transition: background 0.3s;
  }
  .step-dot.active { background: #007bff; }

  /* Slider */
  .custom-slider {
    accent-color: #007bff;
  }
  .slider-wrapper { display: flex; align-items: center; gap: 12px; }
  .slider-value { font-weight: bold; min-width: 30px; }

  /* Category Badge */
  .category-pill {
    background: #eef2ff;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
  }

  @media(max-width: 768px) {
    .display-5 { font-size: 1.8rem; }
    .option-content { font-size: 0.9rem; padding: 8px; }
    .emoji { font-size: 1.5rem; }
  }
</style>

{% endblock %}
